<?php  if (session('errorMsg')) : ?>
    <?php foreach (session('errorMsg') as $error) : ?>
        <div class="alert alert-danger alert-dismissible fade show" role="alert">
            <?= $error ?>
            <button type="button" class="close" data-dismiss="alert" aria-label="Close">
                <span aria-hidden="true">&times;</span>
            </button>
        </div>
        <?php break; ?>
<?php endforeach ?>
<?php endif ?>

<?php if (session('successMsg')) : ?>
    <?php foreach (session('successMsg') as $success) : ?>
        <div class="alert alert-success fade show" role="alert">
            <?= $success ?>
            <button type="button" class="close" data-dismiss="alert" aria-label="Close">
                <span aria-hidden="true">&times;</span>
            </button>
        </div>
        <?php break; ?>
<?php endforeach ?>
<?php endif ?>


$result = $this->service->hasLoginInfo($this->request);
        if($result["status"] === ResultUtils::STATUS_CODE_OK){
            return redirect("admin/home");
        }elseif($result["status"] === ResultUtils::STATUS_CODE_ERR){
            return redirect("admin/login")->with($result['messageCode'], $result['messages']);
        }
        return redirect("admin/home");



<?php

namespace App\Controllers\Admin;

use App\Controllers\BaseController;
use App\Services\ProductsService;


class ProductControllers extends BaseController
{
    /**
        @var Service
     */
    private $service;

    public function __construct()
    {
        $this->service = new ProductsService();
    }


    public function list(): string
    {
        $data = [];


        $cssFiles = [
            'http://cdn.datatables.net/1.10.22/js/jquery.dataTables.min.js',
            base_url() . '/assets/admin/js/datatable.js',
            base_url() . '/assets/admin/js/event.js',

        ];

        $jsFiles = [
            'https://cdn.datatables.net/1.10.22/css/jquery.dataTables.min.css',
            base_url() . '/assets/admin/css/datatable.css'

        ];
        $dataLayout['products'] = $this->service->getAllProduct();
        
        $data = $this->loadMasterLayout($data, 'Danh sách sản phẩm', 'admin/pages/product/list', $dataLayout, $cssFiles, $jsFiles);
     
        return view('admin/main', $data);
    }

    public function add()
    {
        $data = [];
        $data = $this->loadMasterLayout($data, 'Thêm sản phẩm', 'admin/pages/product/add');
        return view('admin/main', $data);
    }

    public function create()
    {
        $result = $this->service->addProductsInfo($this->request);
        return redirect('admin/product/add')->withInput()->with($result['massageCode'], $result['messages']);
    }

    public function addProducts()
    {
        $id = $this->request->getPost('id');
        $images = $this->request->getPost('images');
        $name = $this->request->getPost('name');
        $description = $this->request->getPost('description');
        $amount = $this->request->getPost('amount');
        $category = $this->request->getPost('category');

        $target_dir = "public/uploads";
        $target_file = $target_dir . basename($_FILES["images"]["name"]);
        $uploadOk = 1;
        $imageFileType = strtolower(pathinfo($target_file, PATHINFO_EXTENSION));

        // Check if image file is a actual image or fake image
        if (isset($_POST["submit"])) {
            $check = getimagesize($_FILES["images"]["tmp_name"]);
            if ($check !== false) {
                echo "File is an image - " . $check["mime"] . ".";
                $uploadOk = 1;
            } else {
                echo "File is not an image.";
                $uploadOk = 0;
            }
        }

        // Check if file already exists
        if (file_exists($target_file)) {
            echo "Sorry, file already exists.";
            $uploadOk = 0;
        }

        // Check file size
        if ($_FILES["images"]["size"] > 5000000) {
            echo "Sorry, your file is too large.";
            $uploadOk = 0;
        }

        // Allow certain file formats
        if (
            $imageFileType != "jpg" && $imageFileType != "png" && $imageFileType != "jpeg"
            && $imageFileType != "gif"
        ) {
            echo "Sorry, only JPG, JPEG, PNG & GIF files are allowed.";
            $uploadOk = 0;
        }

        // Check if $uploadOk is set to 0 by an error
        if ($uploadOk == 0) {
            echo "Sorry, your file was not uploaded.";
            // if everything is ok, try to upload file
        } else {
            if (move_uploaded_file($_FILES["images"]["tmp_name"], $target_file)) {
                echo "The file " . htmlspecialchars(basename($_FILES["images"]["name"])) . " has been uploaded.";
            } else {
                echo "Sorry, there was an error uploading your file.";
            }
        }
    }
}

<?php if(isset($userInfo)): ?>
    <h2>Thông tin tài khoản</h2>
    <p>Tên tài khoản: <?= esc($userInfo->username); ?></p>
    <!-- Thêm các thông tin khác của người dùng tại đây -->

    <h3>Đơn hàng của bạn</h3>
    <?php foreach($orders as $order): ?>
        <p>Đơn hàng ID: <?= esc($order->id); ?> - Trạng thái: <?= esc($order->status); ?></p>
        <!-- Thêm chi tiết đơn hàng -->
    <?php endforeach; ?>

    <h3>Sản phẩm yêu thích</h3>
    <?php foreach($favorites as $favorite): ?>
        <p>Sản phẩm: <?= esc($favorite->name); ?></p>
        <!-- Thêm chi tiết sản phẩm -->
    <?php endforeach; ?>
<?php else: ?>
    <p>Bạn cần <a href="login">đăng nhập</a> để xem thông tin này.</p>
<?php endif; ?>



<div class="dash-content">
    <div class="container-fluid">
        <h1 class="dash-title">Trang chủ / Sản phẩm / Thêm mới</h1>
        <div class="row">
            <div class="col-xl-12">
            <?= view('messages/message') ?>
                <div class="card easion-card">
                    <div class="card-header">
                        <div class="easion-card-icon">
                            <i class="fas fa-chart-bar"></i>
                        </div>
                        <div class="easion-card-title"> Thông tin sản phẩm </div>
                    </div>
                    <div class="card-body ">

                    
                        <form action="admin/product/create" enctype="multipart/form-data" method="post">
                            <input name="id" hidden>
                            <div class="form-row">
                                <div class="form-group col-md-6">
                                    <label>Tên sản phẩm</label>
                                    <input value="<?= old('name') ?>" name="name" type="text" class="form-control" placeholder="Nhập tên sản phẩm" required>
                                </div>
                                <div class="form-group col-md-6">
                                    <div class="form-group"><label for="input-choose-image">Ảnh sản phẩm</label>
                                        <input value="<?= old('images') ?>" name="images" type="file" accept="image/*" class="form-control-file" id="input-choose-image" required>
                                    </div>
                                    <div class="form-group">
                                        <img id="img-show" src="" class="img-fluid" alt="Hình đại diện." style="display: none;">
                                    </div>
                                </div>
                            </div>
                            <div class="form-row">
                                <div class="form-group col-md-6">
                                    <label>Giá</label>
                                    <input value="<?= old('price') ?>" name="price" type="text" class="form-control" placeholder="Nhập giá bán" required>
                                </div>
                                <div class="form-group col-md-6">
                                    <label>Mô tả sản phẩm</label></br>
                                    <textarea value="<?= old('description') ?>" name="description" id="description"></textarea>
                                </div>
                            </div>
                            <div class="form-row">
                                <div class="form-group col-md-6">
                                    <label>Danh mục</label>
                                    <input value="<?= old('category') ?>" name="category" type="text" class="form-control" placeholder="Nhập danh mục sản phẩm" required>
                                </div>
                                <div class="form-group col-md-6">
                                    <label>Số lượng</label>
                                    <input value="<?= old('amount') ?>"  name="amount" type="text" class="form-control" placeholder="Nhập số lượng" required>
                                </div>
                            </div>
                            <!-- <div class="form-row">
                                <div class="form-group col-md-12">
                                    <label>Thời gian hỗ trợ</label>
                                    <input name="support" type="text" class="form-control" placeholder="Nhập thông tin hỗ trợ" required>
                                </div>
                            </div> -->
                            <button type="submit" class="btn btn-success">Thêm mới</button>
                            <button type="reset" class="btn btn-secondary">Nhập lại</button>
                        </form>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>



 public function addProductsInfo($requestData)
    {

        $validate = $this->validateAddProducts($requestData);
        if ($validate->getErrors()) {
            return [
                'status' => ResultUtils::STATUS_CODE_ERR,
                'messageCode' => ResultUtils::MESSAGE_CODE_ERR,
                'messages' => $validate->getError()
            ];
        }
        $dataSave = $requestData->getPost();
        $file = $requestData->getFile('images');
        if ($file->isValid() && !$file->hasMoved()) {
            $newName = $file->getRandomName();
            $dataSave['images'] = $newName;
            $file->move('uploads', $newName);
        }
        try {
            $this->product->insert($dataSave);
            return [
                'status' => ResultUtils::STATUS_CODE_OK,
                'messageCode' => ResultUtils::MESSAGE_CODE_OK,
                'messages' => ['success' => 'Thêm sản phẩm thành công']
            ];
        } catch (Exception $e) {
            return [
                'status' => ResultUtils::STATUS_CODE_ERR,
                'messageCode' => ResultUtils::MESSAGE_CODE_ERR,
                'messages' => ['success' => $e->getMessage()]
            ];
        }
    }



                                <?php foreach ($products as $categoryName => $categoryProducts) : ?>
									<h2><?= $categoryName ?></h2>
									<ul>
										<?php foreach ($categoryProducts as $product) : ?>
											<li><?= $product['name'] ?></li>
											<li><img src="uploads/<?php echo $product['images'];?>" height="300.6px" width="279.29px" alt="images"></li>
											<li><?= $product['price'] ?></li>
											<li><?= $product['description'] ?></li>
											<li><?= $product['category'] ?></li>
											<li><?= $product['amount'] ?></li>
										<?php endforeach; ?>
									</ul>
								<?php endforeach; ?>


                                <?php if (!empty($productObj) && is_array($productObj)) : ?>
                                <?php foreach ($productObj as $key => $value) : ?>
                                <div class="product-information">
                                    <?php if ($key === 'images') : ?>
                                    <!-- Hiển thị hình ảnh -->
                                    <img src="uploads/<?= $value; ?>" alt="images" style="width: 60px">
                                    <?php elseif ($key === 'price') : ?>
                                    <!-- Hiển thị giá -->
                                    <h2><?= $value ?> VNĐ</h2>
                                    <?php elseif ($key === 'amount') : ?>
                                    <!-- Hiển thị số lượng -->
                                    <p><b>Số lượng: <?= $value ?></b></p>
                                    <?php elseif ($key === 'category') : ?>
                                    <!-- Hiển thị danh mục -->
                                    <p><b>Danh mục: <?= $value ?></b></p>
                                    <?php else : ?>
                                    <!-- Hiển thị các trường thông tin khác -->
                                    <h2><?= $value ?></h2>
                                    <?php endif; ?>
                                </div>
                                <?php endforeach; ?>
                                <?php endif; ?>
                            </div>
                            <!--/product-details-->


                            

                            <!-- Place the first <script> tag in your HTML's <head> -->
<script src="https://cdn.tiny.cloud/1/hbozepm8v83oquejurp97p1x4p1eymqxvifr4r4izmvfi34i/tinymce/6/tinymce.min.js" referrerpolicy="origin"></script>

<!-- Place the following <script> and <textarea> tags your HTML's <body> -->
<script>
  tinymce.init({
    selector: 'textarea',
    plugins: 'anchor autolink charmap codesample emoticons image link lists media searchreplace table visualblocks wordcount checklist mediaembed casechange export formatpainter pageembed linkchecker a11ychecker tinymcespellchecker permanentpen powerpaste advtable advcode editimage advtemplate ai mentions tinycomments tableofcontents footnotes mergetags autocorrect typography inlinecss',
    toolbar: 'undo redo | blocks fontfamily fontsize | bold italic underline strikethrough | link image media table mergetags | addcomment showcomments | spellcheckdialog a11ycheck typography | align lineheight | checklist numlist bullist indent outdent | emoticons charmap | removeformat',
    tinycomments_mode: 'embedded',
    tinycomments_author: 'Author name',
    mergetags_list: [
      { value: 'First.Name', title: 'First Name' },
      { value: 'Email', title: 'Email' },
    ],
    ai_request: (request, respondWith) => respondWith.string(() => Promise.reject("See docs to implement AI Assistant")),
  });
</script>
<textarea>
  Welcome to TinyMCE!
</textarea>
<button type="button" class="btn btn-primary mt-4">Đăng bài</button>
        